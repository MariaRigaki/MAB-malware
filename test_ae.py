import os
import json
from compare_cuckoo_sig import *
import sys

av = sys.argv[1]
sub = sys.argv[2]
ori_path = 'final_output/cuckoo_json_ori/'
rew_path = 'final_output/cuckoo_json_rewritten/our/%s/%s/' %(av, sub)

list_ori = [ x for x in os.listdir(ori_path) if '.json' in x ]
print(len(list_ori))

list_file = os.listdir(rew_path)
list_file.sort()
print(len(list_file))

good = bad = 0
for idx, f_rew in enumerate(list_file):
    print('[%d/%d (%.2f%%)]----------------------' %(idx, len(list_file), idx / len(list_file)*100))
    print(f_rew)
    s = f_rew.split('_')
    sha256 = s[2].split('.')[0]
    for f_ori in list_ori:
        if f_ori.startswith('.'):
            continue
        if sha256 in f_ori:
            print(f_ori)
            res = compare_sig(ori_path + f_ori, rew_path + f_rew)
            print(res)
            if res:
                good += 1
            else:
                bad += 1
            break

print("good, bad", good, bad)
